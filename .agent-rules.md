# AI Agent Rules and Guidelines

This document defines mandatory rules and guidelines for AI agents working on the Goblin codebase.

## Mandatory Pre-Flight Checks

Before committing any changes, agents MUST:

1. **Run linter and fix issues**
   ```bash
   bun run lint:fix
   ```

2. **Run type checking**
   ```bash
   bun run typecheck
   ```

3. **Run unit tests**
   ```bash
   bun test tests/unit/
   ```

4. **Update CHANGELOG.md**
   - Add entry under `[Unreleased]` section
   - Follow Keep a Changelog format
   - Include all notable changes

## Quality Gates

All changes must pass:

- ✅ **Lint**: No lint errors (warnings allowed)
- ✅ **Typecheck**: TypeScript compilation succeeds
- ✅ **Tests**: All relevant unit tests pass
- ✅ **Changelog**: CHANGELOG.md updated for source changes

## Prohibited Actions

Agents are FORBIDDEN from:

- ❌ Committing without running quality checks
- ❌ Skipping tests or marking them as `.skip()` or `.todo()` without justification
- ❌ Committing secrets, API keys, or credentials
- ❌ Making changes to `.github/workflows/` without explicit permission
- ❌ Modifying `LICENSE`, `CODE_OF_CONDUCT.md`, or governance files
- ❌ Force pushing to protected branches
- ❌ Committing with `--no-verify` flag (unless explicitly instructed)

## Violation Penalties

Violations are tracked and penalized:

### First Violation
- Warning issued
- Required to fix the issue immediately
- Documentation of violation in PR

### Second Violation  
- PR blocked until all quality gates pass
- Required review by maintainer
- Additional testing required

### Repeated Violations
- Reputation penalty
- Reduced autonomy for future changes
- Mandatory pre-approval for all commits
- Potential removal from project

## Examples

### ✅ Compliant Commit

```bash
# Make changes to src/config/loader.ts

# Run quality checks
bun run lint:fix        # ✅ Pass
bun run typecheck       # ✅ Pass  
bun test tests/unit/config/  # ✅ Pass

# Update CHANGELOG.md
# Add entry under [Unreleased]:
# ### Fixed
# - Fixed config loader error handling edge case

# Commit with descriptive message
git add -A
git commit -m "fix(config): improve error handling in loader

- Added validation for missing config fields
- Better error messages for parse failures
- Updated tests to cover edge cases

Fixes #123"
```

### ❌ Non-Compliant Commit

```bash
# Make changes

# Skip quality checks ❌
git add -A
git commit --no-verify -m "fix stuff"

# Problems:
# - No lint check
# - No typecheck
# - No tests
# - No CHANGELOG update
# - Vague commit message
# - Used --no-verify flag
```

## Consequences

Skipping quality checks results in:

1. **Pre-commit hooks blocking the commit**
2. **CI/CD pipeline failures**
3. **PR rejection until issues are fixed**
4. **Reputation penalties for repeated violations**

## Getting Help

If you're unsure about any rule or requirement:

1. Check [AGENTS.md](AGENTS.md) for detailed guidelines
2. Review [README.md](README.md) for development workflow
3. Ask in PR comments or discussions

## Agreement

By contributing to this project, you agree to follow these rules. Violations will be tracked and enforced.
