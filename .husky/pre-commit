#!/usr/bin/env sh
# Husky pre-commit hook
# Runs lint-staged which executes Biome on staged files
# Also runs coverage check (non-blocking warning)

# Exit on any error, but we want to continue for warnings
set -e

# Get the directory of this script
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

# Change to the repository root (one level up from .husky)
cd "$SCRIPT_DIR/.."

# Run lint-staged to check only staged files
echo "ğŸ” Running pre-commit checks on staged files..."
npx lint-staged

echo "âœ… Pre-commit checks passed!"

# Run coverage check (non-blocking)
echo "ğŸ“Š Running coverage check..."
if bun run scripts/coverage-report/analyze.ts --quiet 2>&1; then
  echo "âœ… Coverage check passed!"
else
  echo "âš ï¸  Coverage below threshold - commit allowed but please address coverage gaps"
fi
